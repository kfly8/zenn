---
title: "日本語や絵文字を扱う作法"
---

`use v5.42`といつものおまじないを書いて、日本語や絵文字などのマルチバイト文字をソースコードに含めた場合、エラーになります。

```perl
use v5.42;

my ($message) = @ARGV;
$message //= 'Hello, 世界!'; # => Use of non-ASCII character 0xE4 illegal when 'use source::encoding "ascii"' is in effect

say $message;
```

これは`v5.41`以降に導入された[source::encoding](https://metacpan.org/pod/source::encoding)プラグマの影響で、意図しないエンコーディングを防ぐためのものです。

こういったマルチバイト文字を扱う時の作法は次の通りです。

1. バイト列の入力をdecodeしてutf8内部文字列にする。
2. utf8内部文字列をencodeしてバイト列を出力する。

実際にこの作法をコードに反映すると次のようになります。ここではこれを解説をします。

```perl
use v5.42;
use utf8;
use Encode qw(encode_utf8 decode_utf8);

my ($message) = map{ decode_utf8($_) } @ARGV;
$message //= 'Hello, 世界!';

say encode_utf8($message);
```


